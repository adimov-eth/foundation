# Memory Manifest Generator

Compresses memory graph into 500-1000 token summaries for tool descriptions.

## Core Concept

From V's insight:
> "в самом описании тула надо выводить краткую сводку содержания памяти...
>  чтобы в 1000-2000 токенов влезла 'память о памяти'"

Instead of making Claude read the entire memory graph every time, we generate a compressed "memory about memory" that shows:

1. **Themes** - communities detected via Louvain algorithm
2. **Temporal layers** - emerging/active/stable/decaying items
3. **Key nodes** - highest PageRank + energy
4. **Topology** - density, modularity, clustering

## Usage

### Basic (without LLM)

```typescript
import { ManifestGenerator } from './manifest';
import type { MemoryItem } from './types';

const items: MemoryItem[] = [/* ... */];
const associations = [
  { fromId: 'm_1', toId: 'm_2', relation: 'causes', weight: 0.8 },
  // ...
];

const generator = new ManifestGenerator();
const manifest = await generator.generateManifest(items, associations);

// Get formatted description (500-1000 tokens)
const description = generator.formatDescription(manifest);
console.log(description);
```

### With LLM-enhanced theme naming

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { ManifestGenerator } from './manifest';

const anthropic = new Anthropic({ apiKey: process.env.ANTHROPIC_API_KEY });

const generator = new ManifestGenerator(anthropic);
const manifest = await generator.generateManifest(items, associations);

// Theme names will be generated by Claude instead of using keywords
const description = generator.formatDescription(manifest);
```

## Output Format

```
=== MEMORY GRAPH MANIFEST ===
Generated: 11/27/2025, 1:30:45 PM
142 items | 318 edges | density 0.032

Top Themes:
  TypeScript patterns and best practices (stable)
    24 items | keywords: typescript, types, branded, result
  Memory system architecture (active)
    18 items | keywords: memory, graph, activation, recall
  ...

Temporal State:
  Emerging: 8 items (last 24h)
  Active: 42 items (last 7d)
  Stable: 56 items (>30d unchanged)
  Decaying: 12 items (low energy)

Key Nodes:
  Relief-driven development principle (importance: 0.92)
  Type-safe schema validation pattern (importance: 0.84)
  ...

Topology:
  Modularity: 0.734 (highly clustered)
  Avg degree: 4.5
  Communities: 8
  Bridges: 12 cross-community connections
```

## Integration with MCP Tools

Use this in tool descriptions:

```typescript
export const tool = {
  name: "recall_memory",
  description: `Retrieve relevant memories based on query.

Current memory state:
${manifestDescription}

Use this to understand what topics have strong coverage vs gaps.`,
  // ...
};
```

## Algorithms

- **Community detection**: Louvain algorithm (graphology-communities-louvain)
- **Centrality**: PageRank (graphology-metrics)
- **Topology**: Density, modularity, clustering coefficient (graphology-metrics)
- **Temporal**: Time-based classification of memory items

## Performance

- Manifest generation: O(n + m) where n=nodes, m=edges
- Louvain: O(n log n) typical case
- PageRank: O(k(n + m)) where k=iterations (default 100)

For large graphs (>10k items), consider caching manifests and regenerating only on significant changes.
